<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>WealthPro CRM — Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#0f172a;          /* slate-900 */
      --panel:#111827;       /* gray-900 */
      --panel-2:#1f2937;     /* gray-800 */
      --text:#e5e7eb;        /* gray-200 */
      --muted:#9ca3af;       /* gray-400 */
      --accent:#22c55e;      /* green-500 */
      --accent-2:#3b82f6;    /* blue-500 */
      --warn:#f59e0b;        /* amber-500 */
      --danger:#ef4444;      /* red-500 */
      --ok:#10b981;          /* emerald-500 */
      --chip:#334155;        /* slate-700 */
      --card:#0b1220;        /* custom */
      --border:#243045;      /* custom */
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif;
      color:var(--text);
      background: radial-gradient(1200px 800px at 20% -10%, #112244 0%, rgba(17,34,68,0) 60%) , var(--bg);
    }
    a{color:inherit;text-decoration:none}
    .container{max-width:1200px;margin:0 auto;padding:24px}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
    .title{font-weight:700;font-size:24px;letter-spacing:.3px}
    .subtle{color:var(--muted);font-size:14px}
    .actions{display:flex;gap:8px;flex-wrap:wrap}
    .btn{
      border:1px solid var(--border);
      background:linear-gradient(180deg,#15213a, #0d1527);
      color:var(--text);
      padding:10px 14px;border-radius:10px;font-weight:600;
      display:inline-flex;align-items:center;gap:8px;
      transition:.15s transform,.15s background,.15s border-color;
      cursor:pointer;
    }
    .btn:hover{transform:translateY(-1px);border-color:#38507a;background:#131e36}
    .btn.primary{background:linear-gradient(180deg,#2563eb,#1d4ed8);border-color:#1e40af}
    .btn.primary:hover{background:#1e40af}
    .btn.success{background:linear-gradient(180deg,#10b981,#0ea5e9);border-color:#0ea5e9}
    .btn.warn{background:linear-gradient(180deg,#f59e0b,#d97706);border-color:#b45309}
    .btn.danger{background:linear-gradient(180deg,#ef4444,#dc2626);border-color:#b91c1c}
    .grid{display:grid;gap:16px}
    .grid.cards{grid-template-columns: repeat( auto-fit, minmax(200px,1fr) );margin-bottom:18px}
    .card{
      background: linear-gradient(180deg, #0e172c, #0b1220);
      border:1px solid var(--border);
      border-radius:14px;padding:16px;
      box-shadow: 0 0 0 1px rgba(255,255,255,0.03) inset, 0 6px 18px rgba(0,0,0,0.35);
    }
    .kpi{display:flex;flex-direction:column;gap:8px}
    .kpi .label{color:var(--muted);font-size:12px;text-transform:uppercase;letter-spacing:.12em}
    .kpi .value{font-size:26px;font-weight:800}
    .kpi .hint{color:var(--muted);font-size:12px}
    .section-title{font-weight:700;font-size:16px;margin:0 0 10px 0}
    .toolbar{display:flex;gap:10px;align-items:center;justify-content:space-between;margin-bottom:8px}
    .search{flex:1;display:flex;gap:8px}
    .search input{
      flex:1;padding:10px 12px;border-radius:10px;border:1px solid var(--border);
      background:#0c1425;color:var(--text)
    }
    .table{
      width:100%;border-collapse:collapse;overflow:hidden;border-radius:12px;
      border:1px solid var(--border);background:linear-gradient(180deg,#0f1a30,#0b1220);
    }
    .table th, .table td{padding:12px 10px;border-bottom:1px solid var(--border);text-align:left}
    .table th{font-size:12px;color:var(--muted);letter-spacing:.08em;text-transform:uppercase}
    .row-actions{display:flex;gap:6px;flex-wrap:wrap}
    .chip{display:inline-flex;align-items:center;gap:6px;background:var(--chip);color:#cbd5e1;padding:6px 10px;border-radius:999px;font-size:12px;border:1px solid #3a4b66}
    .pill{padding:4px 8px;border-radius:999px;border:1px solid var(--border);font-size:12px;color:#cbd5e1;background:#0b1220}
    .empty{color:var(--muted);padding:14px}
    footer{margin:28px 0 8px 0;color:#728197;font-size:12px;text-align:center}
    .badge{font-weight:700}
    @media (max-width:800px){
      .hide-sm{display:none}
    }
  </style>
</head>
<body>
  <div class="container">

    <!-- Header -->
    <header>
      <div>
        <div class="title">WealthPro CRM</div>
        <div class="subtle">Dashboard overview</div>
      </div>
      <div class="actions">
        <!-- These are plain links/buttons; no JS required -->
        <a class="btn primary" href="/">Refresh</a>
        <a class="btn" href="/clients/new">New Client</a>
        <a class="btn" href="/tasks/new">New Task</a>
        <a class="btn" href="/products/new-master">New Product Template</a>
        <a class="btn" href="/drive/connect">Connect Google Drive</a>
      </div>
    </header>

    <!-- KPI Cards -->
    <div class="grid cards">
      <div class="card kpi">
        <div class="label">Active Clients</div>
        <div class="value">{{ active_clients|default(0) }}</div>
        <div class="hint">Total clients not archived.</div>
      </div>
      <div class="card kpi">
        <div class="label">Archived Clients</div>
        <div class="value">{{ archived_clients|default(0) }}</div>
        <div class="hint">Kept safely; can be restored.</div>
      </div>
      <div class="card kpi">
        <div class="label">Total AUM</div>
        <div class="value">{{ aum_total|default('£0.00') }}</div>
        <div class="hint">Sums client Products; syncs to dashboard.</div>
      </div>
      <div class="card kpi">
        <div class="label">Tasks (Next 30 days)</div>
        <div class="value">{{ upcoming_tasks_count|default(0) }}</div>
        <div class="hint">Still shows if overdue until completed.</div>
      </div>
    </div>

    <!-- Upcoming Tasks -->
    <div class="card" style="margin-bottom:16px;">
      <div class="toolbar">
        <h3 class="section-title">Upcoming Tasks (30 days)</h3>
        <a class="btn" href="/tasks">View all</a>
      </div>
      {% set tasks = upcoming_tasks|default([]) %}
      {% if tasks and tasks|length > 0 %}
        <table class="table">
          <thead>
            <tr>
              <th>Due</th>
              <th>Client</th>
              <th>Task</th>
              <th class="hide-sm">Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
          {% for t in tasks %}
            <tr>
              <td><span class="pill">{{ t.due_date|default('—') }}</span></td>
              <td>{{ t.client_name|default('—') }}</td>
              <td>{{ t.title|default('—') }}</td>
              <td class="hide-sm">
                {% if t.status|default('ongoing') == 'completed' %}
                  <span class="chip">Completed</span>
                {% else %}
                  <span class="chip">Ongoing</span>
                {% endif %}
              </td>
              <td class="row-actions">
                <a class="btn" href="/tasks/{{ t.id|default('') }}">Open</a>
                <a class="btn success" href="/tasks/{{ t.id|default('') }}/complete">Complete</a>
                <a class="btn danger" href="/tasks/{{ t.id|default('') }}/delete">Delete</a>
              </td>
            </tr>
          {% endfor %}
          </tbody>
        </table>
      {% else %}
        <div class="empty">No upcoming tasks. Create one to get started.</div>
      {% endif %}
    </div>

    <!-- Clients -->
    <div class="card" style="margin-bottom:16px;">
      <div class="toolbar">
        <h3 class="section-title">Clients</h3>
        <div class="search">
          <form action="/clients" method="get" style="display:flex;gap:8px;flex:1">
            <input type="text" name="q" value="{{ query|default('') }}" placeholder="Search clients by name…" />
            <button class="btn" type="submit">Search</button>
          </form>
        </div>
      </div>

      {% set list = clients|default([]) %}
      {% if list and list|length > 0 %}
        <table class="table">
          <thead>
            <tr>
              <th>Name</th>
              <th class="hide-sm">Email</th>
              <th class="hide-sm">Phone</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
          {% for c in list %}
            <tr>
              <td>{{ c.name|default('Unnamed') }}</td>
              <td class="hide-sm">{{ c.email|default('—') }}</td>
              <td class="hide-sm">{{ c.phone|default('—') }}</td>
              <td>
                {% if c.archived %}
                  <span class="chip">Archived</span>
                {% else %}
                  <span class="chip">Active</span>
                {% endif %}
              </td>
              <td class="row-actions">
                <!-- Keep the original behavior: all the familiar buttons remain -->
                <a class="btn" href="/clients/{{ c.id }}/details">Details</a>
                <a class="btn" href="/clients/{{ c.id }}/products">Products</a>
                <a class="btn" href="/clients/{{ c.id }}/tasks">Tasks</a>
                <a class="btn" href="/clients/{{ c.id }}/reviews">Reviews</a>
                <a class="btn" href="/clients/{{ c.id }}/folders">Google Folders</a>

                {% if c.archived %}
                  <a class="btn success" href="/clients/{{ c.id }}/restore">Restore</a>
                {% else %}
                  <a class="btn warn" href="/clients/{{ c.id }}/archive">Archive</a>
                {% endif %}
                <a class="btn danger" href="/clients/{{ c.id }}/delete-soft">Delete (CRM only)</a>
              </td>
            </tr>
          {% endfor %}
          </tbody>
        </table>
      {% else %}
        <div class="empty">No clients yet. Click “New Client” to add your first one.</div>
      {% endif %}
    </div>

    <!-- AUM / Revenue snapshot -->
    <div class="grid cards">
      <div class="card">
        <h3 class="section-title">Assets Under Management (AUM)</h3>
        <p class="subtle" style="margin-top:6px">Sourced from each client’s Products. Matches the dashboard total.</p>
        <div style="margin-top:12px;display:flex;gap:10px;flex-wrap:wrap">
          <span class="chip"><span class="badge">Total:</span> {{ aum_total|default('£0.00') }}</span>
          <span class="chip"><span class="badge">Products tracked:</span> {{ products_count|default(0) }}</span>
        </div>
      </div>
      <div class="card">
        <h3 class="section-title">Quick Links</h3>
        <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
          <a class="btn" href="/products">All Products</a>
          <a class="btn" href="/tasks">All Tasks</a>
          <a class="btn" href="/clients/archived">Archived Clients</a>
          <a class="btn" href="/drive/check">Drive Status</a>
        </div>
      </div>
    </div>

    <footer>
      © {{ now|default('') }} WealthPro CRM
    </footer>
  </div>
</body>
</html>

